% 1000 points
% 2 period range
periods = 10; 
dx = periods*2*pi/1000; 
x = dx:dx:(2*periods*pi); 
y = cos(x); 

y_ft = fftshift(fft(y)); 
dx_ft = 1/x(end); 
x_ft = ((1:1000)-500)*dx_ft - dx_ft; 

figure; plot(x, y, 'o'); 
figure; plot(x_ft*2*pi, abs(y_ft)); 

%% use specific sample rate
% periods = 10; 
% xrate = 35; 
periods = 50; 
xrate = 0.4; 
dx = 1/xrate; 
x = dx:dx:(2*pi*periods); 
y = cos(x) + cos(2*x); 
numpts = numel(x); 

y_ft = fftshift(fft(y)); 
dx_ft = 1/(x(end) - x(1)); 
% x_ft = ((1:numpts)-numpts/2)*dx_ft - dx_ft; 
x_ft = ((1:numpts)-1 - numpts/2)*xrate/numpts; 

figure; plot(x, y, '.'); 
figure; plot(x_ft*2*pi, abs(y_ft)); 

%% use specific dw and sample rate

dw = 0.2;  
xrate = 100; 
dx = 1/xrate; 
periods = (1/dw)/(2*pi); 
x = dx:dx:(2*pi*periods); 
y = cos(x) + cos(2*x); 
numpts = numel(x); 

y_ft = fftshift(fft(y)); 
dx_ft = 1/(x(end) - x(1)); 
% x_ft = ((1:numpts)-numpts/2)*dx_ft - dx_ft; 
x_ft = ((1:numpts)-1 - numpts/2)*xrate/numpts; 

figure; plot(x, y, '.'); 
figure; plot(x_ft*2*pi, abs(y_ft)); 

%%
c = 2.998e8; 
l = 810e-9; 
f = c/l; 
w = 2*pi*f; 

stage = 20e-6; 
distance = 2*stage; 
time = distance/c; 
oscillations = time*2*f

dt_1 = 2*0.5e-6/c
rate = oscillations / dt_1 / 2/w

%% check phase retention: make spectrum, fft, sample, ifft

% create desired spectrum w/ phase
dw = 0.05; 
wlim = 50; 
warray = -wlim:dw:wlim; 
tarray = (-1/dw):(1/wlim):(1/dw); 
% bandwidth 0.05w
% flat phase for w, sloped phase for 2w
bw = 0.05; 
% spectrum_1 = exp(-(warray - 1).^2/(2*bw^2)) .* exp(-1j*pi) ...
%            + exp(-(warray + 1).^2/(2*bw^2)) .* exp(1j*pi) ...
%            + exp(-(warray-2).^2/(2*bw^2)) .* exp(-1j*(warray-2)) ...
%            + exp(-(warray+2).^2/(2*bw^2)) .* exp(1j*(warray+2)); 

% phase_1 = fft
spectrum_1 = exp(-(warray - 1).^2/(2*bw^2)) ...
           + exp(-(warray + 1).^2/(2*bw^2)); 
%            + exp(-(warray-2).^2/(2*bw^2)) ...
%            + exp(-(warray+2).^2/(2*bw^2)); 

figure; hold on; 
yyaxis right
plot(warray, abs(spectrum_1)); 
ylabel('amplitude'); 
yyaxis left
plot(warray, unwrap(angle(spectrum_1))); 
ylabel('phase'); 
xlabel('w');
title('original spectrum'); 
goodplot(); 
 
spectrum_ft_1 = ifftshift(ifft(fftshift(spectrum_1))); 

figure; hold on; 
plot(tarray, real(spectrum_ft_1)); 

oscillations = 1/dw; 
sample_rate_1 = numel(tarray)/oscillations; 

% sample_rate_2 = floor(sample_rate_1)/4.5; 
% numpts_2 = sample_rate_2 * oscillations; 
% skip = floor(numel(tarray)/numpts_2); 
skip = 2; 
tarray_2 = tarray(1:skip:end); 
spectrum_ft_2 = spectrum_ft_1(1:skip:end); 

figure; hold on; 
plot(tarray_2(1:end), real(spectrum_ft_2)); 

dt_2 = tarray_2(2)-tarray_2(1); 
warray_2 = [(-1/dt_2):(2/(tarray_2(end)-tarray_2(1))):(1/dt_2)]; 
spectrum_2 = fft((spectrum_ft_2)); 

figure; hold on; 
yyaxis right; 
plot(warray_2, abs(fftshift(spectrum_2))); 
ylabel('amplitude'); 
yyaxis left; 
plot(warray_2, angle(fftshift(spectrum_2))); 
ylabel('phase'); 
xlabel('w'); 

%% make time domain spectrum, sample, fft: 

oscillations = 60; 
dt_1 = (1/5); % 1/(2*wrange)

tarray_1 = (-oscillations*pi):dt_1:(oscillations*pi); 
signal_1 = cos(tarray_1) .* exp(-tarray_1.^2/2/(5*2*pi).^2); 

figure; hold on; 
plot(tarray_1, signal_1); 

% sample
skip = 50; 
signal_2 = signal_1(1:skip:end); 
tarray_2 = tarray_1(1:skip:end); 
dt_2 = dt_1*skip; 

% FT
signal_ft_1 = fftshift(fft(signal_1)); 
signal_ft_2 = fftshift(fft(signal_2)); 
dw_1 = 1/(tarray_1(end) - tarray_1(1)); 
warray_1 = ((-1/2/dt_1):dw_1:(1/2/dt_1))*2*pi; 
dw_2 = 1/(tarray_2(end) - tarray_2(1)); 
warray_2 = ((-1/2/dt_2):dw_2:(1/2/dt_2))*2*pi; 

% figure; hold on; 
% yyaxis left; 
% plot(warray_1, abs(signal_ft_1)); 
% ylabel('amplitude'); 
% yyaxis right; 
% plot(warray_1, unwrap(angle(signal_ft_1))); 
% ylabel('phase'); 
% xlabel('w'); 

figure; hold on; 
yyaxis left; 
plot(warray_2, abs(signal_ft_2)); 
ylabel('amplitude'); 
yyaxis right; 
plot(warray_2, unwrap(angle(signal_ft_2))); 
ylabel('phase'); 
xlabel('w'); 

%% length units in microns, time in s
c = 2.998E14; 
l = 0.810; 
f = c/l; 
w = 2*pi*f; 

t1 = (-10:0.018:10)*2 ./ c; 
figure; hold on; 
subplot(2,1,1)
plot(t1, cos(w*t1) + cos(w*t1*2)); 
xlabel('time'); 

dt_1 = 2*0.018/c; 
fs_1 = 1/dt_1; 
subplot(2,1,2)
df_1 = 1/(t1(end)-t1(1)); 
f1 = (-(numel(t1)-1)/2:1:(numel(t1)-1)/2)*df_1*l/c; 
plot(f1, abs(fftshift(fft(cos(w*t1) + cos(w*t1*2))))); 
xlabel('frequency'); 



fs_2 = 1.5*f; 
dt_2 = 1/(fs_2); 
t2 = (-4/c:dt_2:4/c); 
figure; hold on; 
subplot(2,1,1)
plot(t2, cos(w*t2) + cos(w*t2*2)); 
xlabel('time'); 
subplot(2,1,2)
df_2 = 1/(t2(end)-t2(1)); 
f2 = (-(numel(t2)-1)/2:1:(numel(t2)-1)/2)*df_2*l/c; 
plot(f2, abs(fftshift(fft(cos(w*t2) + cos(w*t2*2))))); 
xlabel('frequency'); 





